define("xhr",["require","jquery","log"],function(e){var r=e("jquery"),n=e("log")("xhr","info"),o=2e4,t={};return t.get=function(e,t){var i={},s=r.Deferred();return i.context=t,r.ajax({async:!0,cache:!1,type:"GET",contentType:"application/json",url:e,success:function(r,o,t){n.info("get "+e+" ok"),i.response_data=r,s.resolve(i)},error:function(r,o,t){n.error(" get "+e+" : error = "+t),i.error=t,i.textStatus=o,i.xhr=r,s.reject(i)},timeout:o}),s.promise()},t.post=function(e,t,i){var s={},c=r.Deferred();return s.post_data=t,s.context=i,r.ajax({async:!0,cache:!1,type:"POST",contentType:"application/json",url:e,data:t?JSON.stringify(t):"",success:function(r,o,t){n.info("post "+e+" ok"),s.response_data=r,c.resolve(s)},error:function(r,o,t){n.error("POST err: "+e+", responseText: "+r.responseText+", textStatus: "+o),n.error("post "+e+" : error = "+t+", responseText = "+r.responseText+", textStatus = "+o),s.error=t,s.textStatus=o,s.xhr=r,c.reject(s)},timeout:o}),c.promise()},t}),define("button-ctrl",["require","jquery","log","framework"],function(e){function r(e){if("disabled"===t||"busy"===t)return!1;switch(s.busy(),i){case!1:c.send_command(null,"recording-start",null,0).then(function(e){s.set_recording_on(),o.info("recording-start command ok")},function(e){o.error("recording-start command failed with error: "+e)}).always(function(){s.un_busy()});break;case!0:c.send_command(null,"recording-stop",null,0).then(function(e){s.set_recording_off(),o.info("recording-stop command ok")},function(e){o.error("recording-stop command failed with error: "+e)}).always(function(){s.un_busy()})}}var n=e("jquery"),o=e("log")("rec-button-ctrl","info"),t=(e("framework"),"disabled"),i=!1,s={},c=null,a=n("#widget-nav ul.nav li.av-recording"),d=null;return s.init=function(e,o,t,i,s){var u=n.Deferred();return c=s,d=c.perms.has_perm,a.css("display","inline-block"),d("recording","do")&&a.length&&a.on("click",r),u.resolve(),u.promise()},s.enable=function(){"enabled"!==t&&"busy"!==t&&(t="enabled",a.removeClass("disabled"))},s.disable=function(){"disabled"!==t&&"busy"!==t&&(t="disabled",a.addClass("disabled"))},s.busy=function(){"disabled"!==t&&"busy"!==t&&(t="busy",a.removeClass("disabled"),a.addClass("recording-busy"))},s.un_busy=function(){"busy"===t&&(t="enabled",a.removeClass("recording-busy"))},s.start=function(){},s.set_recording_on=function(){i=!0,a.addClass("recording-on")},s.set_recording_off=function(){i=!1,a.removeClass("recording-on")},s}),define("recording",["require","jquery","jade","log","xhr","framework","./button-ctrl"],function(e){var r=e("jquery");window.jade=e("jade");var n=e("log")("recording","info"),o=e("xhr"),t=e("framework"),i=e("./button-ctrl"),s={},c=t.handle("recording"),a=!1;return s.init=function(e,n,o,t){var s=r.Deferred();return i.init(e,n,o,t,c).then(s.resolve.bind(s),s.reject.bind(s)),s.promise()},s.info=function(e,r,o,t){switch(r){case"recording-status":o.recording?i.enable():i.disable(),a=o.you_are_recbot;break;case"recording-start":i.set_recording_on();break;case"recording-stop":i.set_recording_off();break;default:return void n.error("received unknown info_id ("+r+"). Ignoring.")}},s.remote_req=function(e,t,i){var s=r.Deferred();if(!a)return n.error('recieved command "'+e+'", but I am not recbot. rejected'),s.reject("i am not recbot"),s.promise();switch(e){case"recording-start":o.post("https://recbot-localhost.wiziq.com:2179/start",null).then(function(e){s.resolve("xhr start ok",e)},function(e){s.reject("xhr failed with error",e)});break;case"recording-stop":o.post("https://recbot-localhost.wiziq.com:2179/stop",null).then(function(e){s.resolve("xhr stop ok",e)},function(e){s.reject("xhr failed with error",e)});break;default:return n.error("received unknown command ("+e+"). Ignoring."),void n.error(e,t)}return s.promise()},s.start=function(e){return n.info("sess_info = ",e),a=e.you_are_recbot,e.recording===!0&&(i.enable(),n.info("recording is enabled - enabling button")),"recording"===e.current_status?void i.set_recording_on():void i.set_recording_off()},s.stop=function(){i.disable(),o.post("https://recbot-localhost.wiziq.com:2179/end",null).then(function(e){_d.resolve("xhr end ok",e)},function(e){_d.reject("xhr failed with error",e)})},s}),require([""]);