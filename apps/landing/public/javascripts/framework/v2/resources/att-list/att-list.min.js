define("element",["require","jquery"],function(e){var a=e("jquery"),t={},n={},r="_att_skin";return n.handle=function(e,n){var i=t[e];return i||(i=t[e]=a("#"+e+r)),n?i.find("[data-id="+n+"]"):i},n.forget=function(e){t[e]=void 0},n}),define("search",["require","jquery","./element"],function(e){function a(){c=Object.keys(o),c.forEach(function(e){t(e)})}function t(e){var a=o[e].identity,t=a.displayName||"not known",n=a.emails&&a.emails[0].value;n=n||"no email",l.attendees.save_info(v,e,"name",t.toLowerCase()),l.attendees.save_info(v,e,"email",n.toLowerCase())}function n(){var e,a=d(this).val();a&&(a=a.toLowerCase()),c=Object.keys(o),c.forEach(function(t){var n=l.attendees.get_meta(t);if(n&&n.isActive){for(var i=0;i<s.length;i++)if(e=l.attendees.get_info(v,t,s[i]),e&&~e.indexOf(a))return r(t,!0);return r(t,!1)}})}function r(e,a){var t=u.handle(e);return a?t.show():t.hide()}var i,s,o,c,l,d=e("jquery"),u=e("./element"),f={},v="att-list";return f.init=function(e,a){i=a,l=e,o={},d("#atl-search input").on("keyup",n)},f.start=function(){s=["name","email"],o=l.attendees.get_users(),a()},f.add=function(e){t(e.vc_id)},f}),define("scroll",["require","jquery"],function(e){function a(e){var a=t(this),n=a.scrollTop(),s=n>r?Math.ceil:Math.floor;r!=n&&(r=s(n/i)*i,a.scrollTop(r),r=a.scrollTop())}var t=e("jquery"),n={},r=0,i=1;return n.start=function(e){var t=e.find("li").height();i=t?t:"72",e.on("scroll",a)},n}),define("widget",["require","./search","./scroll"],function(e){function a(){var e=c.find("#atl-list").children().length;l.text(e)}function t(e){var a;if(e.history){var t=$(e.history).get(-1);if(t.joined){var n=new Date(t.joined),s=n.getHours(),o=n.getMinutes();_hx=s>12?s-12:s,o=10>o?"0"+o:o,a=_hx+":"+o+(13>s?" am":" pm")}else a="not known"}if(e.avatar=e.photos?e.photos[0].value:null,e.time=a,e.email=e.emails?e.emails[0].value:"no email",e.att_id=e.vc_id+i,e.authvia=e.auth_via||"not known",e.displayName){var c=e.displayName.match(/\b\w/g)||[];c=((c.shift()||"")+(c.pop()||"")).toUpperCase(),e.initials=e.displayName?c:null}e.displayName=e.displayName||"not known",e.mic_clickable=r("av-microphone","mute",e.vc_id),e.cam_clickable=r("av-camera","disable",e.vc_id),e.wc_clickable=r("perms","grant",e.vc_id),e.kick_clickable=r("kick","enable",e.vc_id)}var n,r,i=(e("./search"),"_att_skin"),s={},o={},c={},l={},d={};o.init=function(e,a,t,i){var o=$.Deferred();return n=e,r=n.perms.has_perm,d=i,c=$(a),s=t[1],c.append(t[0]()),l=c.find(".atl-counter"),o.resolve(),o.promise()},o.set_local_user=function(e,a){var n=a[2];t(e),c.find(".atl-me").append(n(e))},o.add_user=function(e){var i=$.Deferred();t(e);var o=s(e);o||d.info("template creation failed"),$("#atl-list").append(o),a();var c=n.perms.check_perm(e.perms,"write","control","*");n.attendees.set_meta(e.vc_id,"write-control",c);var l=r("kick","enable",e.vc_id);return l&&n.attendees.set_meta(e.vc_id,"kick",!0),i.resolve(),i.promise()},o.toggle_visible=function(){$("#widget-attendees").hasClass("show")?$("#widget-attendees").removeClass("show"):$("#widget-attendees").addClass("show")},o.remove_user=function(e){$("#"+e+i).remove(),a()};return o}),define("controls",["require","jquery","./element"],function(e){function a(e){var a=o(this).closest("li").attr("id");if(!a)return l.error("user id not found, did someone change the user template?"),!1;var n=a.replace(v,""),i=o(this).attr("data-id"),s=i.replace("-slashed","");if(val=void 0,d[n]=d[n]||{},"busy"===d[n][s]||!d[n][s])return l.error("key: "+s+", state: "+d[n][s]+", not clickable!"),!1;if(!t(n,s,i))return l.error("element: "+i+" clicked, operation not allowed!"),!1;switch(i){case"microphone":val=!1;break;case"microphone-slashed":val=!0;break;case"camera":val=!1;break;case"camera-slashed":val=!0;break;case"write-control":val=!1;break;case"write-control-slashed":val=!0;break;case"kick":val=!1;break;case"kick-slashed":return void l.error("attendee is being removed avoid this click");default:return void l.info(s+" clicked but isnt handled yet")}if(void 0!==val){var c=!0;f.set_meta(n,s,val,c),r(n,s,"busy")}l.info(n+" key: "+s+", to be val:"+val+", on_click")}function t(e,a,t){var n,r;switch(t){case"microphone-slashed":if(h.free_audio_channels<=0)return!1;break;case"camera-slashed":if(h.free_video_channels<=0)return!1}switch(a){case"microphone":n="av-"+a,r="mute";break;case"camera":n="av-"+a,r="disable";break;case"kick":n=a,r="enable";break;case"write-control":n="perms",r="grant";break;default:return!0}return i(n,r,e)}function n(e,a,t){var n=c.handle(e,a),r=c.handle(e,a+"-slashed"),i=t?n:r,s=t?r:n;i.css("display","inline-block"),s.css("display","none")}function r(e,a,t){if("busy"!==t&&"set"!==t)return void l.error("change_state: invalid state = ",t);var n=c.handle(e,a),r=c.handle(e,a+"-slashed"),i="att-state-"+t,s="busy"===t?"att-state-set":"att-state-busy";n.addClass(i),n.removeClass(s),r.addClass(i),r.removeClass(s),d[e][a]=t}var i,s,o=e("jquery"),c=e("./element"),l={},d={},u={},f={},v="_att_skin",h={};u.init=function(e,t){var n=o.Deferred();return s=e,l=t,window.att_api=s.attendees,f=s.attendees,i=s.perms.has_perm,o("body").on("click","#atl-list .atl-control",a),h.free_audio_channels=0,h.free_video_channels=0,n.resolve(),n.promise()},u.change=function(e,a,t){if("audio-level"!=a&&t!==!0&&t!==!1)return void l.error("controls.change: invalid value for val",t,'expected "true" or "false"');d[e]=d[e]||{};d[e][a];"audio-level"!==a&&(n(e,a,t),r(e,a,"set"))},u.forget=function(e){d[e]=void 0,c.forget(e)},u.manage=function(e,a,t,n){h.free_audio_channels=e.free_audio_channels,h.free_video_channels=e.free_video_channels;var r=c.handle(a,t+"-slashed");n&&o(r).hasClass("read-only")&&o(r).removeClass("read-only"),o(r).hasClass("read-only")||o(r).addClass("read-only")};return u}),define("listener",["require","events","./search","./widget","./controls"],function(e){function a(e,a){switch(e){case"in":a.forEach(function(e){c.add_user(e),o.add(e)});break;case"out":c.remove_user(a),l.forget(a);break;case"control_changed":l.change(a.vc_id,a.known_key,a.value);break;case"kick":r.send_command(a.vc_id,a.key,a.value).then(function(){i.set_meta(a.vc_id,a.key,a.value)},function(){i.set_meta(a.vc_id,a.key,!a.value)});break;default:h.info("Ignoring event : "+e)}}function t(e,a){switch(h.info("ev : "+e),e){case"channel-status":var t;t=a.free_audio_channels>0?!0:!1,n(a,"microphone",t),t=a.free_video_channels>0?!0:!1,n(a,"camera",t);break;default:h.info("Unhandled event : "+e+". Do nothing")}}function n(e,a,t){var n=r.attendees.get_users();Object.keys(n).forEach(function(r){if(n[r].meta.isActive){if(!t)return void l.manage(e,r,a,!1);l.manage(e,r,a,!0),null==n[r].meta[a]&&l.change(r,a,!1)}})}var r,i,s=e("events"),o=e("./search"),c=e("./widget"),l=e("./controls"),d="framework:attendees",u="av:channel",f="att-list",v={},h={};return v.init=function(e,n){h=n,r=e,i=e.attendees,s.bind(d,a,f),s.bind(u,t,f)},v}),define("att-list",["require","jquery","framework","scrollbar","events","log","./widget","./controls","./search","./listener"],function(e){function a(e){var a=n("#widget-nav li#nav-attendees");a.hasClass("enabled")?a.removeClass("enabled"):a.addClass("enabled"),s.toggle_visible()}function t(){n("#widget-attendees").perfectScrollbar(),n("#widget-attendees").resize(function(e){n("#widget-attendees").perfectScrollbar("update")})}var n=e("jquery"),r=e("framework"),i=(e("scrollbar"),e("events"),e("log")("att-list","info")),s=e("./widget"),o=e("./controls"),c=e("./search"),l=e("./listener"),d={},u=r.handle("att-list"),f=[];return d.init=function(e,r,d){var v=n.Deferred(),h=function(e){f.push(u.template(e))};if(!e.anchor||e.templates.length<3)return v.reject("wrong info from backend").promise();var m=e.anchor,_=n("#nav-attendees");return e.templates.forEach(h),_.on("click",a),n(m).on("click","#atl-header a.fa-times",a),t(),s.init(u,m,f,i),o.init(u,i),c.init(u,i),l.init(u,i),v.resolve(),v.promise()},d.start=function(){s.set_local_user(n.extend({},u.identity),f);var e=u.attendees.get_users();Object.keys(e).forEach(function(a){s.add_user(n.extend({},e[a].identity))}),c.start()},d.remote_req=function(e,a){var t=n.Deferred();switch(i.info({command:e,data:a},"command received from remote end"),e){case"kick":return n('[data-remodal-id="signout-confirm"] button.remodal-confirm').trigger("click"),t.resolve("done");default:return i.error("Unknown command received"),t.reject("unrecognized command : "+e)}return t.promise()},d}),require([""]);